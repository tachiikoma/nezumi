====== hdd-rep-rec.lite ======
<sub>{{hdd-rep-rec.lite.odt|Original file}}</sub>

====== ремонт и восстановление жестких дисков ======

крис касперски

**в прошлых статьях мы подробно рассмотрели методику восстановления логических разрушений (форматирование, удаление файлов и т. д.) и теперь перейдем к самой сложной и ответственной части — аппаратным отказам жесткого диска и путям их преодоления.**

Рисунок 1 жесткие диски — так они выглядят

===== введение =====

Объемы жестких дисков стремительно растут, а их надежность неуклонно падает. С одной стороны поджимает плотность записи, с другой — конкуренция. Повсеместно применяются дешевые комплектующие и "сырые" технические решения, обкатывать которые приходится конечному потребителю, то есть мне и вам. Залог безопасности данных — ежедневное резервирование (тем более, что современные съемные носители это позволяют), однако, как показывает практика, даже продвинутые специалисты (не говоря уже о пользователях типа "секретарша") пренебрегают этой рекомендацией, ведь все "и так работает"…

Рисунок 2 этому жесткому диску уже ничто не поможет, но в большинстве случаев их все-таки

После отказа винчестера данные практически всегда можно спасти, если действовать по плану. Если же плана нет (еще не нарос или уже скурили), от "врачевания" лучше сразу отказаться. Неумелые попытки только затрудняют процедуру восстановления, а то и делают ее совсем невозможной. Сотрудники сервис центров настоятельно отговаривают пользователей от самостоятельного ремонта, а за ослушание карают либо удвоенной (утроенной) ценой, либо же отказываются от восстановления. И вовсе не потому, что бояться, что клиент сможет обойтись без их помощи! Жесткий диск — очень сложное устройство. Это не радиоприемник, который можно отремонтировать и без знаний радиотехники! У работников сервисного центра есть оборудование, знания и опыт. Через их руки прошла куча винчестеров, поэтому шансы на успешное восстановление данных здесь намного выше, чем у простого программиста или администратора, рыдающего над убитым диском. Это — теоретически. Практически же… Цена за восстановление зачастую переходит все границы, причем, никаких гарантий на благоприятный исход все равно нет. Известно немало случаев, когда кустари забесплатно поднимали винчестеры, угробленные "специалистами" сервис-центров. А для жителей глубинки никакие "центры" вообще не доступны и приходится рассчитывать только на себя.

Мы будем говорить о восстановлении данных. Ремонт винчестеров (за исключением редких случаев) невозможен или экономически нецелесообразен. Нашей задачей будет временное восстановление работоспособности жесткого диска, достаточное лишь для копирования самых ценных данных, в идеале — всего диска целиком.

===== что нам понадобиться =====

Непременным атрибутом серьезной фирмы была и остается "чистая комната" с классом чистоты 100 (в одном кубическом футе воздуха содержится не более 100 пылинок размером 0,5 миллиметров). За этими незатейливыми словами скрывается грандиозное инженерное сооружение со стоимостью от 30 тыс. долларов. Менее серьезные ремонтники ограниваются "чистой камерой", что на порядок дешевле, но для кустарных мастеров даже это неподъемно дорого. Можно ли обойтись без чистой комнаты или соорудить ее самостоятельно?

Рисунок 3 чистая комната, в которой вскрывают гермоблоки жестких дисков

Вопреки распространенным слухам и опасениям — да, можно! Как минимум достаточно обыкновенной незапыленной комнаты с работающим кондиционером или даже без него. Так же желательно обзавестись ионизатором (ионизатор вызывает слипание частичек пыли, и они вместо того, чтобы носиться по комнате оседают на пол, откуда их удаляет нехитрая система вентиляции). Хороший ионизатор стоит в передах $500 – $1.000, но при желании его можно сконструировать и самостоятельно. Взять хотя бы туже "Люстру Чижевского", схему которой легко найти в старых журналах "Радио", "Моделист-Конструктор" или в Интернете. Естественно, непосредственно перед проведением работ ионизатор нужно выключать.

Рисунок 4 схематичное устройство типовой чистой комнаты

При ремонте винчестеров на более или менее постоянной основе имеет смысл соорудить некоторое подобие чистой камеры. Для этого требуется стеклянный аквариум, воздушный фильтр и компрессор, нагнетающий воздух внутрь аквариума и препятствующий попаданию пыли через открытую переднюю стенку. Да! Передняя стенка остается открытой! Аквариум ставится на "бок", открытой стороной на себя. Сверху закрепляется стеклянная пластина закрывающая до 2/3 поверхности, а внутрь устанавливается воздушный фильтр. Компрессор остается снаружи. Оставшаяся 1/3 закрывается другой пластинкой, на несколько часов включается фильтр (точное время зависит от его пропускной способности и объема аквариума), а затем, перед самым началом работ, нижняя пластинка удаляется, предоставляя простор рукам. Невероятно дешево, но вполне "стерильно". Во всяком случае намного чище открытой жилой комнаты. Учитывая непродолжительное время вскрытия гермозоны (сделал дело и тут же закрыл), на пластины успевает осесть не так уж много пыли и у винчестера есть все шансы считать данные до смертельного исхода.

Рисунок 5 чистая камера

После выполнения всех операций винчестер следует обязательно закрыть крышкой, предварительно удалив попавшие пылинки с помощью балкончика с воздухом для продувки двигателей, который можно купить в авто-магазине. Поскольку в трубке образуется конденсат, первые порции струи выпускаются в сторону от винчестера и затем плавно направляются на диск. Другая неприятная особенность заключается в том, что балкончик нельзя встряхивать, иначе из него полезет белая непотребность, которая добьет диск окончательно. Сергей Яценко подготовил видеоматериал, на котором все это наглядно проиллюстрировано: http://pc3k.rsu.ru/video/video03_N40P_disk_swap.avi (157 Мбайт).

Продолжительная работа с "оголенной" гермозоной даже в чистой камере недопустима! Частицы пыли, присутствующее в воздухе, сталкиваясь с бешено вращающейся пластиной, за короткий срок уничтожают магнитное покрытие. На дисках со стеклянной подложкой (например, винчестерах типа DTLA) образуется настоящий "иллюминатор". Но ведь при вскрытии гермоблока в него все равно попадает пыль! Разве от закрытия крышки она исчезнет? По этому поводу вспоминается анекдот: Вася, закрой форточку, на улице холодно! — От того, что я ее закрою на улице теплее не станет! Штука. На самом деле, внутри гермоблока расположен фильтр рециркуляции, активно поглощающий попавшую пыль, в результате чего ее концентрация быстро уменьшается до приемлемых значений. А вот при работе в стиле "ню", концентрация пыли остается постоянной. Другая причина — закрученная крышка слегка деформирует гермоблок, поэтому без нее диск может читаться нестабильно, с многократными повторами. Установка крышки — это целое дело! Запустив утилиту, выводящую скоростную кривую на экран, попеременно подтягиваем болты, добиваясь наиболее ровного графика чтения. Впрочем, это уже излишество.

Рисунок 6 для жесткого диска каждая пылинка равносильна метеориту

Часы жизни винчестера, вскрытого вне чистой комнаты, сочтены, а время, требующееся для вычитки данных, — велико, особенно если используются аппаратно-программные комплексы, не поддерживающие режимов DMA/ULTRADMA. Поэтому, жесткий диск лучше подключать к компьютеру напрямую и в первую очередь вычитывать только самые важные данные, установив счетчик повторов чтения на значение 3х. То есть, сначала читаем все, что читается само, и только потом — то, что читается с трудом.

Вторым козырем серьезных фирм являются только что упомянутые аппаратно-программные комплексы. Наибольшую известность получили PC-3000 от ACELab (www.acelab.ru) и HDDRepairTools от BVGGroup (www.bvg-group.ru). Что это такое? С "железной" точки зрения это обыкновенный (даже слегка ущербленный) IDE-контроллер, поддерживающий режимы PIO и отчасти DMA/UDMA со встроенным электронным ключом (как правило, собранном на мощном полевом транзисторе) и позволяющий подсоединять/отсоединять жесткие диски "на лету", без выключения компьютера, что очень удобно. Однако, того же эффекта можно достичь, если подсоединить жесткий диск к отдельному блоку питания, а перед его выключением подать ATA-команду 94h (standbyimmediate).

Рисунок 7 аппаратно-программный комплекс PC-3000, установленный в компьютер

Технологические команды, приоткрывающие дверь во внутренний мир жесткого диска, передаются либо по ATA-интерфейсу, либо через COM-терминал. Да-да! На многих моделях винчестеров имеется интегрированный COM-порт, подключившись к которому, можно контролировать процесс инициализации и управлять приводом (правда, не на всех дисках он распаян, то есть выведен на разъем). Обычного COM-порта, встроенного в компьютер, плюс пары переходников, которые любой радиолюбитель легко смастерит самостоятельно, для наших целей вполне достаточно. Еще в аппаратно-программных комплексах имеется возможность в любой момент подать RESET, что помогает в случае "зацикливания" жесткого диска. Штатные IDE-контроллеры на это не способны, но что мешает прицепить на IDE-шину свою кнопку или просто замкнуть пинцетом выводы?

Рисунок 8 жесткий диск, подключенный через стандартный ATA-порт (широкий ленточный кабель) и через технологический COM-терминал с помощью адаптера PC-KALOC, входящего в комплект поставки PC-3000 (узкий ленточный кабель)

Зачем же тогда люди приобретают аппаратно-программные комплексы, отстегивая за них ненормальные деньги? (В частности, PC-3000 в полном комплекте обойдется в несколько тысяч заживо убитых енотов). А за поддержку и сервис! Сам по себе PC-3000 бесполезен или почти бесполезен. Но к нему прилагается документация с подробным описанием методики восстановления различных моделей винчестеров, имеется база служебных модулей, к услугам которой приходится прибегать, если родная "служебка" отправляется к праотцам, наконец, в стоимость комплекса входят консультация и обучение. К тому же, прилагается нехилое программное обеспечение, в частности DataExtractor, отличительной чертой которого является способность автоматического восстановления транслятора (во врезке "прошивка, индивидуальные настройки и адаптивы" мы об этом еще поговорим) плюс продуманный механизм "вычитывания" информации. Если сектор прочитался, он заносится в базу и в дальнейшем никогда не читается с диска повторно (разве, что специально об этом попросить), а всегда берется из базы. Большинство распространенных утилит (например, GetDataBack от RuntimeSoftware) ведут себя совсем не так. Они многократно перечитывают одни и те же сектора, особенно сектора, принадлежащие служебным областям диска, такие как FAT или MFT, или вообще аварийно завершают свою работу при встрече с BAD-сектором. В случае логических разрушений все ОК, но для восстановления жестких дисков такой подход непригоден. Можно, конечно, написать такую утилиту самостоятельно или доработать близкий по духу OpenSource проект, можно раздобыть готовую служебку в сети или слить ее с аналогичной модели винчестера, но… на все это требуется время, а времени всегда не хватает. Наличие специализированного комплекса существенно упрощает дело. Тем не менее, PC-3000 не панацея! Специалист, умеющий ремонтировать жесткие диски, при необходимости обойдется и без него, а не умеющему он _//**ничем_**// не поможет.

Из инструментов нам в первую очередь понадобятся отвертки-звездочки. Для старых винчестеров — номер 10, для новых — номер 9. При отсутствии звездочек можно воспользоваться и обыкновенной плоской отверткой. В частности, звездочка-10 соответствует плоской-3. Под звездочку-9, отвертку придется затачивать самостоятельно. Впрочем, сейчас звездочки уже не проблема и приобрести их можно в любом техническом магазине.

Остальной инструментарий вполне стандартен. Пассатижи, плоскогубцы, пинцеты… Для перестановки "блинов" придется собрать специальный захват, устройство и приемы работы с которым наглядно продемонстрированы в уже упомянутом видеоматериале Сергея Яценко (http://pc3k.rsu.ru/video/video03_N40P_disk_swap.avi).

В процессе ремонта нам придется заниматься демонтажем микросхем. Для этого нужен либо строительный фен, либо паяльник плюс фантазия. Фен обойдется примерно в ~$50, но им еще необходимо научиться пользоваться. Сергей Яценко подготовил специальный видеоматериал, демонстрирующий технику демонтажа ПЗУ с помощью паяльной стации http://pc3k.rsu.ru/video/video02_WDC_ROM.avi (13 Мб). Паяльная станция это, конечно, не фен, но принципы работы с ней схожи. Если фена нет, можно обойтись паяльником с расплющенным жалом, лезвием (для демонтажа планарных микросхем) и медицинской иглой со сточенным концом (для демонтажа элементов, установленных в отверстия со сквозной металлизацией). О самом демонтаже можно прочитать в статье "Лудить, паять, кастрюли-ведра чиним" (www.computerra.ru/offline/1998/251/1400/).

===== устройство жесткого диска =====

Жесткий диск состоит из гермоблока и платы электроники. В гермоблоке расположен шпиндельный двигатель, вращающий пакет из одного или нескольких магнитных дисков, блок магнитных головок (сокращенно БМГ), ранее управляемый шаговым двигателем, а теперь устройством под названием "звуковая катушка" (voicecoil), а так же предусилитель коммутатор чтения/записи, смонтированный в микросхеме либо непосредственно на БМГ, либо расположенный на отдельной плате рядом с ней. В последнем случае замена коммутатора возможна без съема БМГ, что существенно упрощает его ремонт.

Рисунок 9 блок-схема типичного жесткого диска

Плата электроники включает в себя: контроллер шпиндельного двигателя и звуковой катушки, управляющий вращением пакета диска и позиционированием головок; канал чтения/записи; микроконтрллер, являющийся по сути, "сердцем" винчестера; контроллер диска, отвечающий за обслуживание ATA-интерфейса.

===== как их ремонтируют =====

Древние жесткие диски стоили дорого, использовали "рассыпуху" микросхем с низкой степенью интеграции и серийные комплектующие, над которыми еще имело смысл подолгу зависать с осциллографом, выискивая неисправный элемент. Но затем степень интеграции начала стремительно нарастать, производители перешли на заказные чипы, а цены на винчестеры упали ниже Арктических холодов. Ремонтировать электронику теперь не только сложно, но еще и нерентабельно.

Основным способом возвращения работоспособности стала замена всей платы контроллера целиком. Берется диск идентичный модели (донор), и плата переставляется на гермоблок с восстанавливаемыми данными (акцептор). Исключение составляет мелкий ремонт типа замены перегоревшего предохранителя или транзистора, который можно выполнить непосредственно на теле "пациента".

Рисунок 10 плата электроники, готовая к пересадке

Возникает естественный вопрос — если ремонтники уже давно ничего не ремонтируют, а только тасуют платы, зачем же к ним обращаться и платить деньги, когда эту операцию можно проделать и самому? Но все не так просто!

Во-первых, необходимо найти подходящего донора. У разных моделей винчестеров совместимость плат электроники сильно неодинакова, некоторые требуют совпадения всех цифр в номере модели, некоторые соглашаются работать и с "родственным" контроллером. А некоторые могут не работать даже при полном совпадении всех букв и цифр и тогда приходится перебирать одного донора за другим, в надежде найти подходящего. Особенности поведения каждой модели можно почерпнуть из документации, прилагаемой к PC-3000 или найти в Интернете. Поиски доноров серьезно осложняются тем, что период производства большинства винчестеров намного меньше их среднего срока существования. Компьютерные магазины постоянно обновляют свой ассортимент и приобрести модель аналогичную той, что вы купили несколько лет назад, скорее всего не удастся. Остаются радио-рынки и фирмы, торгующие поддержанными комплектующими, но выбор здесь никакой.

Рисунок 11 коллекция винчестеров-доноров, используемая при пересадке контроллеров

//**Внимание: неродной контроллер может повредить микросхему коммутатора/предусилителя, расположенную внутри гермоблока и разрушить служебную информацию, что значительно затруднит дальнейший ремонт, поэтому не переставляйте платы, если не уверены в их совместимости!**//

Во-вторых, помимо электроники плата контроллера несет на своем борту ПЗУ, в котором могут быть записаны индивидуальные настройки. И с чужой платой винчестер работать просто не будет! Тут есть два пути. Если акцептор еще не совсем сдох, с него считывается оригинальная прошивка и заливается на плату донора. В противном случае приходится перепаивать непосредственно само ПЗУ.

В-третьих, даже если винчестер "заведется" чужой платой, последовательность нумерации секторов может оказаться нарушена и файловая система превратиться в мусор, который придется разгребать руками или специализированными программными комплексами (лучшим из которых является DataExtractor, входящий в комплект PC-3000, но так же способный работать и отдельно от него со штатным IDE-контроллером).

Тем не менее, никаких экстраординарных способностей для ремонта не требуется и он вполне по силам мастерам средней руки. Отказ электроники это ерунда. Хуже, если испорчена часть служебной информации, записанной на магнитных пластинах (см. врезку "прошивка, индивидуальные настройки и адаптивы". Это может произойти по разным причинам: ошибки в прошивке, сбои питания, отказ электроники, вибрация/удары, деформация гермоблока и т. д. и т. п. При этом жесткий диск не входит в готовность или на все команды отвечает ошибкой. Некоторые винчестеры автоматически переходят в технологический режим, предназначенный для заливки служебной информации, которая может быть передана либо через стандартный ATA-интерфейс, либо через COM-терминал.

В состав PC-3000 входит большая коллекция разнообразных служебных модулей для популярных моделей жестких дисков, а всем зарегистрированным пользователем предоставляется бесплатный доступ к ftp-серверу, на котором можно найти практически все, что угодно. Как вариант, можно воспользоваться специализированными утилитами, распространяемыми производителями винчестера, выбрав режим обновления прошивки. Однако, при этом обновляется далеко не все модули и далеко не для всех моделей такие утилиты есть.

К тому же этот способ восстановления бесполезен, если в служебной зоне имеются физические дефекты или накопитель "зависает" еще на старте, отказываясь входить в технологический режим. На этот случай существует метод Hot-Swap (горячая замена). В нем так же участвуют два накопителя — донор и акцептор, но трансплантация осуществляется в живую под местным наркозом. Донор обесточивается, с него снимается плата электроники, обнажая гермоблок. Акцептор подключается к IDE-шлейфу, на него подается питание, затем после процесса инициализации и выдачи готовности, отдается ATA-команда Sleep (95h), останавливающая шпиндельный двигатель. Все остальные узлы остаются под напряжением. Контроллер аккуратно свинчивается и переставляется на гермоблок акцептора. Затем ему подается любая команда для пробуждения (например, команда чтения сектора). Поскольку, контроллер уже был проицилизирован, обращения к служебной зоне не происходит и с диска удается считать всю уцелевшую информацию. (При использовании штатного IDE-контроллера необходимо заблаговременно отключить SMART в настройках BIOSSetup, иначе винчестер будет вести SMART-протокол, производя запись в служебную зону). Требования к совместимости плат электроники — те же самые, что и в случае простой перестановки контроллера. В принципе, не обязательно переставлять плату донора на акцептор. Можно взять плату акцептора, проинициализировать ее на гермоблоке донора, а затем вернуть обратно. Такой способ даже более предпочтителен, поскольку в этом случае, акцептор будет работать со "своим" ПЗУ.

Ряд неисправностей требует вскрытия гермоблока и ювелирного мастерства рук. Первое место по частоте отказов занимает выход из строя одной или нескольких магнитных головок. Причиной может быть и заводской брак, и пробой электроники, и механическое воздействие (например, удар). Если физически головка остается неповрежденной, то одна из поверхностей перестает читаться и тогда через каждые N секторов образуется BAD, где N – количество головок. Некоторые модели имеют 6 головок, некоторые — только одну, тогда при ее отказе диск становится полностью неработоспособным и не может прочитать даже служебную зону. Но и при отказе 1'й из 6'ти головках информация превращается в труху. Все файлы, размер которых превышает 3 Кб (512 * 6), становятся продырявленными. Что делать? Переставлять блок головок! Это очень сложная операция и у начинающих мастеров в половине случаев она заканчивается летальным исходом. Практиковаться на своем рабочем винчестере, который надо восстановить, категорически недопустимо! Сначала потренируйтесь на "кошках" — жестких дисках разной степени убитости, на которых нет ничего интересного.

Нам потребуется донор близкой модели. Точное совпадение всех цифр модели здесь не обязательно, главное, чтобы БМГ быть аналогичного типа. Некоторые диски паркуют головки за пределами внешней кромки магнитных пластин, некоторые — в специальной зоне близ центра шпинделя. Последний случай самый тяжелый. Ведь для того, чтобы снять головки их нужно протащить через всю поверхность, а допускать контакта головки с поверхностью ни в коем случае нельзя, иначе магнитное покрытие будет повреждено!

Рисунок 12 блок магнитных головок с микросхемой коммутатора/предусилителя

Вооружившись тонкой полоской выгнутого и обезжиренного пластика, аккуратно заводим ее под каждую головку, так чтобы пластик приподнимал головку над поверхностью, но сам ее не касался и выводим головки за пределы внешний кромки. Чтобы головки не касались и не царапали друг друга между ними вставляется полоска полиэтилена, которую можно вырезать из антистатической упаковки жесткого диска. Меняется только БМГ. "Родной" магнит звуковой катушку акцептора остается тот же самый. В зону парковки магнитные головки заводятся аналогичным образом, только наоборот. Остается закрутить винт оси позиционера и надеть крышку на гермоблок. При включении винчестера наверняка раздаться жуткий рыдающий звук, а скорость чтения упадает в разы. Это следствие работы с чужим БМГ, на неродных адаптивах. Подтягивая винты крышки, можно до некоторой степени выровнять график чтения. Долго в таком состоянии жесткий диск работать не может, поэтому необходимо как можно скорее приступать к вычитываю поверхности, начиная с наиболее ценных данных. Подробнее об этом читайте в статье "Как я переставлял блок головок на Fujitsu MPG3409AH, чтобы спасти информацию. (Записки сумасшедшего ремонтника)" Сергея Казанского: http://onehalf.pisem.net/stat/heads.html.

Рисунок 13 инструмент для перемещения БМГ, изготавливаемый из узкой полоски пластика (1), обжимаемый на разогретом металлическом стержне (2)

Некоторые жесткие диски содержат только одну магнитную головку и в случае ее отказа выгоднее переставлять сам магнитный "блин" как это показано в уже упомянутом видеоматериале Сергея Яценко: http://pc3k.rsu.ru/video/video03_N40P_disk_swap.avi.

Так же приходится сталкиваться с "залипанием" магнитных головок, в прямом смысле слова прилипшим к поверхности за счет сил межмолекулярного притяжения. Некоторые источники рекомендуют в этом случае просто крутануть диск в горизонтальном направлении, но польза от этого действия очень сомнительна, а вот вред оно может нанести немалый и зачастую непоправимый (например, повредить подвески головки с последующим фрезированием магнитной поверхности). Лучше разобрать гермоблок и аккуратно приподнять головки с помощью уже знакомого нам куска изогнутого пластика, вернув их в зону парковки. Подробности — в статье Сергея Яценко: "Восстановление гермоблока IBM DJNA371350 после падения": http://www.acelab.ru/pcTechSupport/DOSvers/MFGFeatures/IBM/VGPP.html (только для зарегистрированных пользователей PC-3000).

Еще встречается повреждение коммутатора/предусилителя или обрыв гибкого шлейфа. Если он расположен непосредственно на БМГ (особенно в микросхеме бескорпусного исполнения), то весь БМГ меняется целиком по вышеописанной методике.

Звуковая катушка в силу своей конструктивной простоты практически никогда не отказывает (там просто нечему ломаться), но вот выводные провода обломаться могут, однако, их легко припаять.

Рисунок 14 звуковая катушка

Шпиндельный двигатель очень надежен и перегорает/замыкает обмотками только в исключительных случаях, но вот клин гидродинамического подшипника вполне распространенное явление, и тогда его приходится расклинивать по методике, описанной в http://www.acelab.ru/pcTechSupport/DOSvers/TechDoc/Barracuda4.html (только для зарегистрированных пользователей PC-3000).

===== >>> врезка прошивка, индивидуальные настройки и адаптивы =====

Электроника диска — это только скелет. Без управляющих микропрограмм она работать не будет! Первые модели винчестеров хранили микропрограммы в ПЗУ, что вызывало естественные неудобства и накладывало определенные ограничения. Теперь же для этой цели используется сам жесткий диск! Разработчик резервирует некоторый объем и размещает в нем весь необходимый код и данные. Информация организована в виде модулей (слабое подобие файловой системы) и управляется специализированной операционной системой. В ПЗУ остается лишь базовый код, своеобразный "фундамент" винчестера. Некоторые производители идут еще дальше, убирая из ПЗУ все, кроме первичного загрузчика.

Само ПЗУ может быть расположено как внутри микроконтроллера, так и на отдельной микросхеме. Практически все винчестеры имеют FLASH-ROM, но не на всех моделях она распаяна. Если FLASH-ROM установлена, то микроконтроллер считывает прошивку из нее, если нет — обращается к своему внутреннему ПЗУ.

Часть модулей (и информации, находящейся в ПЗУ) одинакова для всей серии винчестеров. К ней в первую очередь относится совокупность управляющих микропрограмм. Эти модули полностью взаимозаменяемы и один диск свободно может работать с модулем другого без каких либо последствий.

Часть модулей (реже — информации из ПЗУ) готовится отдельно для каждой партии. Так, например, паспорт диска, описывающий его конфигурацию, указывает количество головок, физических секторов и цилиндров. В процессе инициализации микропроцессор опрашивает коммутатор и перечисляет головки. Если их количество не совпадает с указанным в паспорте, винчестер может "забастовать" и не войти в готовность. Зачастую производители отключают некоторые головки из-за дефектов поверхности, неисправностей самих головок или по маркетинговым соображениям. Как следствие — образуются внешне очень похожие модели-близнецы, но непосредственная перестановка плат невозможна и паспорт приходится корректировать, для чего опять-таки понадобится PC-3000. Но, в принципе, подобрать донора с идентичным паспортом вполне возможно и без коррекции.

Все зло и коварство происходит от модулей (и часто информации, защитой в ПЗУ), //**уникальных для каждого экземпляра винчестера **//и настраиваемых строго индивидуально. В частности, каждый жесткий диск имеет как минимум два списка дефектов — P-list (от Primary – первичный) и G-list (от Grown – растущий). В P-list заносятся номера дефективных секторов, обнаруженные еще на стадии заводского тестирования, а G-list формируется самим жестким диском в процессе его эксплуатации. Если запись в сектор происходит с ошибкой, сбойный сектор переназначается другим сектором, взятым из резервной области. Некоторые жесткие диски поддерживают список "подозрительных секторов": если сектор начинает читаться не с первого раза, он замещается, а информация о замещении сохраняется либо в отдельном списке, либо в G-list'е.

Все эти процессы протекают скрыто от пользователя. Специальный модуль, называемый транслятором, переводит физические адреса в номера логических блоков или виртуальные цилиндры-головки-сектора и внешне нумерация секторов не нарушается. Все работает нормально до тех пор, пока P/G-list'ы не оказываются разрушенными или на гермоблок устанавливается плата с чужими настройками. Если P/G-list'ы хранятся во FLASH-ROM (а часто так и бывает), файловая система оказывается полностью неработоспособной, ведь трансляция адресов нарушена! И хотя на сектором уровне все читается нормально, совершенно непонятно какой сектор какому файлу принадлежит.

К счастью восстановить транслятор довольно просто, поскольку практически все файловые структуры (да и сами файлы) имеют характерные последовательности байт (сигнатуры). Для начала нужно очистить таблицы транслятора (сгенерировать пустые P/G-list'ы), в противном случае сектора, помеченные у донора как замещенные, не смогут прочитаться на акцепторе. Различные винчестеры имеют различное число замещенных секторов. В некоторых замещенных секторов может не быть вообще, на некоторых их количество может доходить до нескольких тысяч. Формат P/G-list'ов варьируется от одной модели к другой и для работы с ним лучше всего применять PC-3000. В крайнем случае — утилиты от производителей винчестера или ATA-команду unassign.

Затем необходимо просканировать весь диск на предмет поиска характерных сигнатур и загнать их "физические" адреса в список. Разумеется, никакой физикой в подлинном смысле этого слова здесь и не пахнет! Скажем так: логические адреса без переназначенных секторов, но это слишком долго писать.

Теперь, исследуя служебные структуры файловой системы (каталоги, MFT), мы определяем номера кластеров подчиненных структур. Переводим кластеры в сектора и создает еще один список. В результате у нас получается два списка, между которыми прослеживается четкая корреляция. Первый список как бы "растягивается" вдоль второго. Другими словами, каждый переназначенный сектор увеличивает расхождение между последующими "физическими" и логическими адресами на единицу. Проделав необходимые математические вычисления, мы сможем рассчитать необходимую поправку и как бы восстановить транслятор. "Как бы" потому что целевые адреса замещенных секторов остаются неизвестными, а, значит, в восстанавливаемых данных образуются "дыры", однако, большая часть информации все же возвращается из небытия. PC-3000 автоматически восстанавливает транслятор, используя довольно продвинутые алгоритмы, которые постоянно совершенствуются. Тем не менее, при большом желании утилиту для восстановления транслятора можно написать и самостоятельно.

А вот чего ни PC-3000, ни другие комплексы не умеют так это восстанавливать адаптивы. Нашествие адаптипов началось сравнительно недавно. До этого индивидуальные настройки диска сводились к высокоуровневым наслоениям, никак не препятствующим чтению информации на физическом уровне. Перестановка плат могла привести к невозможности работы с диском средством операционной системы, но данные всегда было можно прочитать посекторно стандартными ATA-командами или на худой конец на уровне физических адресов в технологическом режиме.

Но плотность информации неуклонно росла и нормативы допусков ужесточались, а, значит, усложнялся и удорожался производственный цикл. В промышленных условиях невозможно изготовить два абсолютно одинаковых жестких диска. В характеристиках аналоговых элементов (катушек, резисторов, конденсаторов) неизбежно возникает разброс, следствием которого становится рассогласование коммутатора-предусилителя. Но с этим еще как-то можно бороться. Сложнее справится с неоднородностью магнитного покрытия, влекущего непостоянность параметров сигнала головки, в зависимости от угла поворота позиционера. Таким образом, производитель должен либо уменьшить плотность информации до той степени, при которой рассогласованиями можно пренебречь (но в этом случае для достижения той же емкости придется устанавливать в диск больше пластин, что удорожает конструкцию и вызывает свои проблемы), либо улучишь качество производства (но это настолько нереально, что при современном уровне развития науки, экономики и техники даже не обсуждается), либо калибровать каждый жесткий диск индивидуально, записывая на него так называемые адаптивные настройки. Вот по этому пути производители и пошли.

Состав и формат адаптивом меняется от модели к модели. В грубом приближении сюда входят: ток записи, усиление канала, профиль эквалайзера, напряжение смещения для каждой головки, таблица коррекции параметров каждой головки для каждой зоны и т. д. и т. п. Без своих родных адаптивов жесткий диск просто не будет работать! Даже если случится чудо и чужие адаптивы все-таки подойдут (а чудес, как известно, не бывает) информация будет считываться очень медленно и с большим количеством ошибок. Подобрать адаптивы нереально, рассчитать их в "домашних" условиях тоже. Но ведь как-то же эти адаптивы возникают? Чисто теоретически, для заполнения таблицы адаптивов не нужно ничего, кроме самого винчестера и некоторые модели жестких дисков даже содержат в прошивке специальную программу Self-Scan, как раз и предназначенную для этих целей. Да, она действительно рассчитывает адаптивы с "нуля", но… при этом уничтожает всю содержащуюся на жестком диске информацию, что делает ее непригодной для наших целей.

Адаптивы могут хранится как на самом диске в служебной зоны (и тогда смена плат проходит на ура, но не работает HotSwap), либо в микросхеме FLASH-ROM, которую перед заменой плат следует перепаять. Диски без адаптивов встречаются все реже и реже, можно сказать, что практически вообще не встречаются.

===== какой диск выбрать? =====

Своему винчестеру мы доверяем самое дорогое что у нас есть — свои данные. Знакомые меня постоянно спрашивают: какого производителя выбрать? Какой модели отдать предпочтение? Цена не критична. Остальные параметры (ну, быть может, за исключением шума) тоже. Главное — чтобы он не сдох без предупреждений. (Медленная смерть, сопровождающаяся посторонними звуками типа визга или шума и размножающимися BAD-секторами не в счет, тут любому понятно, что диск надо менять). Я сам задаю себе тот же вопрос, но… как говорится, "во вселенной существуют вопросы, на которые нет ответов". У жестких дисков нет надежности. Вместо этого у них гарантийный талон. И точка. На сотни тысяч часов наработки на отказ, приводимых в документации, можно не опираться, поскольку они берутся с потолка и производитель за них не отвечает (а следовало бы…).

Не бывает "хороших" и "плохих" производителей. С каждым брендом случались свои проколы. Независимо от производителя, в партии из тысячи дисков, от одного до десяти винчестеров возвращаются задолго до истечения гарантийного срока, даже если они позиционируются как серверные модели. Все решает вероятность. Кому-то жить, а кому-то умирать.

Правильнее говорить о неудачных (то есть "падучих") моделях. Например, печально известная серия FujitsuMPG, в которой использовалась микросхема CirrusLogic с измененным составом подложки, со временем образовывала паразитные утечки и практически все эти винчестеры вымерли в течении 2х лет. Или вот IBM DTLA (в просторечии называемый дятлом) с идиотской конструкцией разъема гермоблока, вызывающей периодический неконтакт и как следствие — преждевременный обрыв операции записи. Часть сектора записана, часть — нет. В результате на диске образуются виртуальные BAD-сектора (контрольная сумма не совпадает, но физических дефектов нет), которые можно (в принципе) прочитать, но нельзя восстановить (данные не дописаны). У меня было три дятла. Один сдох в течении первых 2х месяцев, но был успешно отремонтирован и заброшен на полку как враг народа. Два других успешно работают до сих пор. А сколько дисков полетело у моих знакомых — не сосчитать! Все решает слепая вероятность и, может быть, даже судьба (у одного винчестера одна карма, у другого — другая). Ну и качество блока питания, отсутствие вибраций, наконец!

Сбор статистики затруднен еще и потому, что ее просто не откуда взять. Абсолютное количество отказов само по себе еще ни о чем не говорит. Требуется учесть распространенность данной модели и условия эксплуатации. SCSI-диски надежнее IDE только потому, что они устанавливаются на серверах и работают практически никогда не выключаясь (а большинство неисправностей как раз и происходит в момент включения/выключения), им неведомо что такое перегрев или "винт в сумке".

На сайте фирмы Derstein, занимающейся восстановлением данных, приводится любопытная статистика зафиксированных отказов (http://www.derstein.ru/cgi-bin/stat.cgi?do=show), которую я в сокращенном виде привожу ниже. Одна таблица — по производителям, другая — по моделям.

|производитель|количество зафиксированных отказов|
|Fujitsu|498|
|IBM|393|
|Maxtor|210|
|Quantum|110|
|Western Digital|95|
|Samsung|49|
|Seagate|42|
|Conner|3|

Таблица 1 статистика отказов жестких дисков по производителям

|модель|количество зафиксированных отказов|
|IBM(IC35L040AVER07-0) 41.0 Gb|119|
|Fujitsu(MPG3204AT) 20.4 Gb|83|
|Fujitsu(MPG3409AT) 40.9 Gb|57|
|Fujitsu(MPG3102AT) 10.2 Gb|54|
|Fujitsu(MPG3204AH) 20.4 Gb|48|
|IBM(DTLA 307030) 30.7 Gb|37|
| Fujitsu(MPG3409AH) 40.9 Gb|32|
|IBM(IC35L020AVER07-0) 20.5 Gb|31|
|Fujitsu(MPE3204AT) 20.4 Gb|29|
|Seagate(340016A) 40.0 Gb|28|

Таблица 2 статистика отказов жестких дисков по моделям

Как видно, самым наилучшим производителем оказался Samsung (хотя, лично у меня против него стойкое предубеждение и вовсе не факт, что малое количество отказов не вызвано низкой популярностью таких дисков).

Тем не менее, у всех производителей встречаются неудачные модели, к тому же, как уже говорилось, источник отказов зачастую располагается вне диска. Поэтому, вопрос о надежности правильнее ставить так: "какой диск имеет наибольшие шансы на успешное восстановление?".

За этим я обратился к ведущему инженеру фирмы ACELab Сергею Яценко, через руки которого прошли тысячи дисков: "//Ответ на вопрос "какие же диски лучше" в ключе, какие из ////них проще восстанавливать: более удачны в восстановлении (проще подобрать блок головок в случае проблем с ним, практически нет самоповреждения записи, сравнительно низкое количество экстремально сложных узлов): Seagate, Samsung, Hitachi-IBM(HGST), Fujitsu(2.5"), ну и может быть Toshiba(2.5"), хотя у последней есть очень мерзкая проблема с протеканием подшипника шпиндельного двигателя из-за того, что крышка его не приварена, как у других, а приклеена... Хотя у ////Maxtor////'а она тоже приклеена, но из-за значительно большей толщины и габаритов проблемы с ней не возникают. Название компаний я упорядочил по мере увеличения проблематичности их дисков...//

//Далее идут диски, которые доставляют массу неприятностей при восстановлении, хотя может и отказывают не значительно чаще представителей первого списка (этот список так же упорядочен по нарастанию глючности)://

  - //Maxtor (очень "порадовали" глючной записью и нестабильностью головок);//
  - //WDC (крайне сложно подобрать исправные головки и восстановить функциональность служебной зоны в некоторых случаях, плюс у них статический транслятор, что приводит к невозможности прочитать данные пользователя в случае разрушения модулей транслятора и таблицы дефектов в служебной зоне);//
  - //Quantum (хотя компании уже нет, но диски продолжают дохнуть и при этом практически невосстановимы). Самый действенный способ восстановления, но не самый продуктивный — это заморозка. В некоторых случаях отмороженный при -10 гр. Цельсия диск в течении где-то получаса начинает отдавать данные... Но этот трюк проходит не часто. Замена головок у них крайне затруднена и в случае 3х и более голового диска практически не реальна (вернее реальна, но при впечатляющих трудозатратах);//
//Если у кого-то стоят Quantum AS, советую скорее от них избавится. ////Maxtor//// и WDC со своими трудностями справляются с явной неохотой...//

//Естественно, объективную оценку дать сложно, но ситуация, по тому что мы наблюдаем, обстоит так//".

===== заключение =====

Мы рассматривали исключительно общие вопросы ремонта жестких дисков, и в пошаговую методику диагностики не вдавались. Это обширная тема, требующая для каждой модели своего подхода и к тому же уже описанная в документации на ACELab, фрагменты которой доступы и незарегистрированным пользователям: http://www.acelab.ru/products/pc/traning.html. Так что не будем повторяться.ы

Главное — что ремонт жестких дисков в домашних условиях все-таки возможен!


